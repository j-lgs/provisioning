---
# Local network gateway.
gateway: "10.0.0.1"
# Local network nameserver.
nameserver: "10.0.0.1"

# Virtual shared IP exposed by Keepalived.
apiproxy_ip: "10.0.1.30"
# Kubernetes apiserver port that's exposed on the shared IP.
apiproxy_port: "6443"
# Kubernetes apiserver port that's exposed on each node.
local_apiproxy_port: "443"

# Version of kubernetes to install in the cluster. Currently on 1.23.6 due to the --port flag being removed
kubernetes_version: "1.23.6"

# Wireguard allowedips for controlplane nodes. Must be inside the same range as the node wireguard IPs.
wg_allowedips: "10.123.0.0/24"

# Virtual router ID that's shared between Keepalived nodes.
vrid: 11

# Talos cluster name
cluster_name: gensokyo-cluster.local
# Matches the bootdisks described by the terraform configuration
disk: "/dev/vda"
# Make sure to set up your DNS so the chosen endpoint address resolves to the same value as apiproxy_ip.
endpoint: "https://10.0.1.30:6443"
# Used by the talos client to the talos API.
endpoints: '"10.0.1.31" "10.0.1.32" "10.0.1.33"'
# Default node for talos API operations to act upon.
default_node: "10.0.1.31"
# Enable the cluster discovery feature
discovery: true

# An ip for the ingress-nginx controller that will be provided by metallb.
ingress_ip: "10.0.1.25"
ingress_ssl_port: "8443"
ingress_http_port: "8080"

controlplanes:
- name: eientei-control-1 # Doesn't need to match what was defined in the terraform configuration.
  # TODO: Derive the node's IP from it's CIDR address.
  ip: "10.0.1.31"
  cidr: "10.0.1.31/17"
  wg: true # Enable the node's Wireguard tunnel.
  wg_ip: "10.123.0.10" # Wireguard IP. Must match what the VPS's loadbalancer has.
  api_proxy: true # Haproxy and Keepalived static containers for a HA controlplane.
  state: MASTER # The node's role within the Keepalived cluster
  priority: 200 # The node's priority within the Keepalived cluster.
  # TODO: Dynamically generate peers.
  peers:
  - "10.0.1.33" # The node's peers within the Keepalived cluster.
  - "10.0.1.32"
- name: eientei-control-2
  api_proxy: true
  ip: "10.0.1.32"
  cidr: "10.0.1.32/17"
  wg: true
  wg_ip: "10.123.0.11"
  state: BACKUP
  priority: 50
  peers:
  - "10.0.1.33"
  - "10.0.1.31"
- name: eientei-control-3
  api_proxy: true
  ip: "10.0.1.33"
  cidr: "10.0.1.33/17"
  wg: true
  wg_ip: "10.123.0.12"
  state: BACKUP
  priority: 25
  peers:
  - "10.0.1.31"
  - "10.0.1.32"

workers:
- name: eientei-worker-1
  # Does the worker node use an IGPU?
  igpu: true
  # Should privileged containers be enabled on this worker?
  privileged: true
  # Is this node a Mayastor storage node?
  storage: true
  cidr: "10.0.1.50/17"
